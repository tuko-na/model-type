**システム名:** `本システム`

### 1. システム概要と核となる原則 (The "Why")

このセクションは、本システムが「何を」すべきかを定義する後続のEARS要件を、AIが正しく解釈するための「思想」を定義する。

- 1.1. システムの目的:
    
    本システムは、個人またはグループが所有する製品を**「型番（model_number）」をキーとして管理するWebアプリケーションである。その核となる機能は、製品に紐づく「インシデント（故障、メンテ履歴）」を記録・管理し、そのデータを「統計」**として可視化することにある。
    
- 1.2. 核となる思想 (型番の重要性):
    
    本システムが「商品名」ではなく**「型番」**を中心とする理由は、データの「一意性」を確保し、「統計」の価値を最大化するためである。「AQUOSが壊れた」というデータは統計的価値が低いが、「4T-C50EN1が壊れた」というデータは故障予測につながる価値を持つ。したがって、PM-01からPM-03のサジェスト機能は、単なる入力補助（UX）のためだけではなく、データの名寄せと一意性を担保するという重要な目的を持つ。
    
- 1.3. 核となる制約 (プライバシー):
    
    本システムのデータ（購入日、故障履歴、統計）は、Amazon（公開カタログ）やレビューサイト（公開掲示板）とは根本的に異なり、**「プライベートな金庫」**と同等の機密性を持つ。したがって、AC-01の認証必須の原則は、**プライバシー保護（生活感の流出防止）**というシステムの最重要要件を満たすために不可欠である。
    

---

### 2. 認証とアクセス制御 (EARS)

- **要件ID: AC-01 (認証必須の原則)**
    - `IF` ユーザーが認証（ログイン）されていない場合, `WHEN` ユーザーが「ランディングページ」「ログイン画面」「新規登録画面」以外のURLにアクセスしようとした, `THEN` `本システム` `shall` ユーザーを強制的に「ログイン画面」にリダイレクトする。
- **要件ID: AC-02 (データの隔離)**
    - `WHEN` ユーザーが認証済みの場合, `本システム` `shall` ユーザーが所属する`group`（グループ）に紐づくデータ（`products`, `incidents`, 統計）のみを表示し、操作を許可する。
    ただし、オプトインに基づき個人が特定できないよう匿名集計された全体統計データは、この限りではない。

---

### 3. ユーザーとグループ管理 (EARS)

- **要件ID: UG-01 (自動グループ作成)**
    - `WHEN` 新規ユーザーがアカウント登録を完了した, `THEN` `本システム` `shall` 1. 新しい`group`を自動的に作成し（例：「マイ・アイテム」）、 2. そのユーザーを当該`group`の「オーナー」として割り当てる。
- **要件ID: UG-02 (平等な機能権限)**
    - `WHILE` ユーザーが`group`に所属している（オーナーまたはメンバーである）場合, `本システム` `shall` 当該`group`内のすべての`products`（商品）および`incidents`（インシデント）に対する完全なCRUD（作成、読み取り、更新、削除）権限と統計閲覧権限を付与する。
- **要件ID: UG-03 (オーナーの管理権限)**
    - `WHERE` ユーザーが`group`の「オーナー」である場合, `本システム` `shall` 当該`group`の「メンバー管理機能」（招待、削除）の実行を許可する。

---

### 4. 商品管理 (EARS)

- **要件ID: PM-01 (型番サジェスト - ヒット時)**
    - `WHEN` ユーザーが「商品登録フォーム」の「型番」フィールドに入力した, `IF` 入力された`model_number`（型番）が`model_suggestions`（内部辞書）テーブルに存在した場合, `THEN` `本システム` `shall` 関連する`name`（商品名）、`manufacturer`（メーカー名）、`category`（カテゴリ）の各フィールドをフォームに自動入力する。
- **要件ID: PM-02 (型番サジェスト - ミス時)**
    - `WHEN` ユーザーが「商品登録フォーム」の「型番」フィールドに入力した, `IF` 入力された`model_number`が`model_suggestions`テーブルに存在しない場合, `THEN` `本システム` `shall` `name`, `manufacturer`, `category`の各フィールドの手動入力をユーザーに要求する。
- **要件ID: PM-03 (内部辞書の更新)**
    - `WHEN` ユーザーが`product`（商品）の保存（新規作成または更新）を正常に完了した, `THEN` `本システム` `shall` `model_suggestions`テーブル内の該当する`model_number`エントリを、最新の`name`, `manufacturer`, `category`情報で更新（または新規作成）する。
- **要件ID: PM-04 (商品データの所有権)**
    - `本システム` `shall` すべての`product`レコードが、必ず単一の`group`レコードに紐づくことを保証する。

---

### 5. インシデントと統計 (EARS)

- **要件ID: IS-01 (インシデントの紐付け)**
    - `本システム` `shall` すべての`incident`レコードが、必ず単一の`product`レコードに紐づくことを保証する。
- **要件ID: IS-02 (統計データの隔離)**
    - `WHEN` ユーザーが「統計ダッシュボード」を閲覧する, `THEN` `本システム` `shall` ログイン中のユーザーが所属する`group`のデータのみに基づいて統計を計算し、表示する。
- **要件ID: IS-03 (寿命の算出ロジック)**
    - `本システム` `shall` 「製品寿命」に関する統計を算出する際、1. 「新品（New）」として購入された製品のみを対象とし、 2. 寿命の終了時点を「`products.status`が廃棄に変更された日」または「`incidents`において自然故障（Failure）により廃棄（Disposed）されたイベントの発生日」として定義する。
- **要件ID: IS-04 (統計ノイズの排除)**
    - `本システム` `shall` 型番ごとの「平均寿命」や「故障率」を算出する統計プロセスにおいて、`purchase_condition`が「中古」の製品、および`incident_type`が「自然故障（Failure）」以外の理由（事故、紛失等）による廃棄データを、集計対象から自動的に除外する。
- **要件ID: IS-05 (全体統計への参加と閲覧)**
    - `本システム` `shall` ユーザーに対して、自身のデータを匿名化して全体統計に提供する「オプトイン設定」の変更を許可する。また、`IF` ユーザーがオプトインを有効にしている場合のみ, `THEN` `本システム` `shall` 他のオプトインユーザーのデータから集計された「全体統計（型番別の平均寿命、故障傾向など）」の閲覧を許可する（Give-and-Takeの原則）。
- **要件ID: IS-06 (詳細分析データの提供)**
    - `本システム` `shall` ユーザーに対し、以下の詳細な分析データを提供する。1. 製品ごとの「総所有コスト（TCO）」（`purchase_price` + `incidents.cost`の合計）、2. 型番ごとに頻発する「故障症状（Symptoms）」（`symptom_tags`の集計に基づく）。
---

### 6. 非機能要件 (EARS)

- **要件ID: NFR-01 (開発言語)**
    - `本システム` `shall` **PHP**言語および**Laravel**フレームワークを使用して構築される。
- **要件ID: NFR-02 (フロントエンド)**
    - `本システム` `shall` **Livewire**を使用して非同期UIを実現し、**Tailwind CSS**を使用してスタイリングとレスポンシブ対応を行う。
- **要件ID: NFR-03 (ORM)**
    - `本システム` `shall` **Eloquent** ORMを使用してデータベースと対話する。
- **要件ID: NFR-04 (開発DB)**
    - `本システム` `shall` 開発環境において**SQLite**データベースを使用する。
- **要件ID: NFR-05 (本番DB)**
    - `本システム` `shall` 本番環境において**MySQL**または**PostgreSQL**データベースを使用する。
- **要件ID: NFR-06 (開発サーバー)**
    - `本システム` `shall` ローカル開発環境において`php artisan serve`コマンドで起動するビルトインサーバーを使用する。
- **要件ID: NFR-07 (デモ公開)**
    - `本システム` `shall` QRコードによるデモ体験のために、**Expose**または**ngrok**によるトンネル機能での一時的な公開に対応可能であること。